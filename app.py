import streamlit as st
import random
import base64
from PIL import Image, ImageDraw
import io
import time

# Configuration de la page
st.set_page_config(
    page_title="ğŸŒŠ Tsunami Expert", 
    page_icon="ğŸŒŠ", 
    layout="wide"
)

# ==================== STYLE MODERNE ====================
st.markdown("""
<style>
    .main-header {
        font-size: 2.8rem;
        color: #1e88e5;
        text-align: center;
        margin-bottom: 1rem;
        font-weight: bold;
    }
    .chat-container {
        background: white;
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 20px;
        border: 1px solid #e0e0e0;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .sidebar-content {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 12px;
        margin: 12px 0;
        border-left: 4px solid #1e88e5;
    }
    .emergency-box {
        background: linear-gradient(135deg, #ff5252, #d32f2f);
        color: white;
        padding: 18px;
        border-radius: 12px;
        text-align: center;
        font-weight: bold;
    }
    .question-btn {
        background: linear-gradient(135deg, #4caf50, #2e7d32);
        color: white;
        border: none;
        padding: 12px 18px;
        border-radius: 10px;
        margin: 6px 0;
        width: 100%;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 600;
        font-size: 0.9em;
        text-align: left;
    }
    .question-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(76,175,80,0.3);
    }
    .arabic-text {
        direction: rtl;
        text-align: right;
        line-height: 1.8;
        font-size: 1.05em;
    }
    .category-header {
        color: #1e88e5;
        border-bottom: 2px solid #1e88e5;
        padding-bottom: 8px;
        margin-top: 20px;
        font-weight: bold;
    }
</style>
""", unsafe_allow_html=True)

# ==================== SYSTÃˆME MULTILINGUE ====================

LANGUAGES = {
    "ğŸ‡«ğŸ‡· FranÃ§ais": "fr",
    "ğŸ‡¬ğŸ‡§ English": "en", 
    "ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©": "ar"
}

# ==================== BASE DE CONNAISSANCES AMÃ‰LIORÃ‰E ====================

KNOWLEDGE_BASE = {
    # ========== DÃ‰FINITION ET CAUSES ==========
    "definition_tsunami": {
        "keywords": {
            "fr": ["dÃ©finition", "qu'est-ce", "c'est quoi", "explique", "dÃ©finir", "quoi", "tsunami"],
            "en": ["definition", "what is", "explain", "define", "what", "tsunami"],
            "ar": ["ØªØ¹Ø±ÙŠÙ", "Ù…Ø§ Ù‡Ùˆ", "Ø´Ø±Ø­", "Ù…Ø§Ù‡Ùˆ", "Ù…Ø§", "ØªØ³ÙˆÙ†Ø§Ù…ÙŠ"]
        },
        "responses": {
            "fr": """
**ğŸŒŠ DÃ‰FINITION DU TSUNAMI**

Un **tsunami** (mot japonais signifiant "vague du port") est une sÃ©rie de vagues ocÃ©aniques extrÃªmement longues gÃ©nÃ©rÃ©es par le dÃ©placement soudain d'un grand volume d'eau.

**CaractÃ©ristiques principales :**
- **Vitesse** : 500-800 km/h en eau profonde (comme un avion de ligne)
- **Hauteur** : 30 cm Ã  1m en mer â†’ 10-30m prÃ¨s des cÃ´tes
- **Longueur d'onde** : 100-200 km (vs 100m pour une vague normale)
- **PÃ©riode** : 10-60 minutes entre les vagues successives

**MÃ©canisme physique :** Le dÃ©placement vertical du fond marin pousse toute la colonne d'eau, crÃ©ant des ondes qui se propagent dans toutes les directions.
            """,
            "en": """
**ğŸŒŠ TSUNAMI DEFINITION**

A **tsunami** (Japanese for "harbor wave") is a series of extremely long ocean waves generated by the sudden displacement of a large volume of water.

**Key characteristics:**
- **Speed**: 500-800 km/h in deep water (like a jet airliner)
- **Height**: 30 cm to 1m at sea â†’ 10-30m near coasts
- **Wavelength**: 100-200 km (vs 100m for normal wave)
- **Period**: 10-60 minutes between successive waves

**Physical mechanism**: Vertical seabed displacement pushes the entire water column, creating waves that propagate in all directions.
            """,
            "ar": """
**ğŸŒŠ ØªØ¹Ø±ÙŠÙ Ø§Ù„ØªØ³ÙˆÙ†Ø§Ù…ÙŠ**

**Ø§Ù„ØªØ³ÙˆÙ†Ø§Ù…ÙŠ** (ÙƒÙ„Ù…Ø© ÙŠØ§Ø¨Ø§Ù†ÙŠØ© ØªØ¹Ù†ÙŠ "Ù…ÙˆØ¬Ø© Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡") Ù‡Ùˆ Ø³Ù„Ø³Ù„Ø© Ù…Ù† Ø£Ù…ÙˆØ§Ø¬ Ø§Ù„Ù…Ø­ÙŠØ· Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ù‹Ø§ Ø§Ù„Ù†Ø§ØªØ¬Ø© Ø¹Ù† Ø§Ù„Ø§Ù†Ø²ÙŠØ§Ø­ Ø§Ù„Ù…ÙØ§Ø¬Ø¦ Ù„Ø­Ø¬Ù… ÙƒØ¨ÙŠØ± Ù…Ù† Ø§Ù„Ù…Ø§Ø¡.

**Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:**
- **Ø§Ù„Ø³Ø±Ø¹Ø©**: 500-800 ÙƒÙ…/Ø³Ø§Ø¹Ø© ÙÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¹Ù…ÙŠÙ‚Ø© (Ù…Ø«Ù„ Ø§Ù„Ø·Ø§Ø¦Ø±Ø© Ø§Ù„Ù†ÙØ§Ø«Ø©)
- **Ø§Ù„Ø§Ø±ØªÙØ§Ø¹**: 30 Ø³Ù… Ø¥Ù„Ù‰ 1Ù… ÙÙŠ Ø§Ù„Ø¨Ø­Ø± â†’ 10-30Ù… Ø¨Ø§Ù„Ù‚Ø±Ø¨ Ù…Ù† Ø§Ù„Ø³ÙˆØ§Ø­Ù„
- **Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ**: 100-200 ÙƒÙ… (Ù…Ù‚Ø§Ø¨Ù„ 100Ù… Ù„Ù„Ù…ÙˆØ¬Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©)
- **Ø§Ù„ÙØªØ±Ø©**: 10-60 Ø¯Ù‚ÙŠÙ‚Ø© Ø¨ÙŠÙ† Ø§Ù„Ø£Ù…ÙˆØ§Ø¬ Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ©

**Ø§Ù„Ø¢Ù„ÙŠØ© Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©**: Ø§Ù„Ø§Ù†Ø²ÙŠØ§Ø­ Ø§Ù„Ø±Ø£Ø³ÙŠ Ù„Ù‚Ø§Ø¹ Ø§Ù„Ø¨Ø­Ø± ÙŠØ¯ÙØ¹ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø§Ø¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ù…ÙƒÙˆÙ†Ù‹Ø§ Ù…ÙˆØ¬Ø§Øª ØªÙ†ØªØ´Ø± ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª.
            """
        }
    },
    
    "difference_vague_tsunami": {
        "keywords": {
            "fr": ["diffÃ©rence", "comparaison", "vague normale", "vague vs tsunami", "diffÃ©rent"],
            "en": ["difference", "compare", "normal wave", "wave vs tsunami", "different"],
            "ar": ["ÙØ±Ù‚", "Ù…Ù‚Ø§Ø±Ù†Ø©", "Ù…ÙˆØ¬Ø© Ø¹Ø§Ø¯ÙŠØ©", "Ù…ÙˆØ¬Ø© Ù…Ù‚Ø§Ø¨Ù„ ØªØ³ÙˆÙ†Ø§Ù…ÙŠ", "Ù…Ø®ØªÙ„Ù"]
        },
        "responses": {
            "fr": """
**ğŸŒŠ DIFFÃ‰RENCE ENTRE TSUNAMI ET VAGUE NORMALE**

| CaractÃ©ristique | Vague Normale | Tsunami |
|-----------------|---------------|---------|
| **Cause** | Vent | SÃ©isme/Glissement |
| **Longueur d'onde** | 100-200 m | 100-200 km |
| **Vitesse** | 10-60 km/h | 500-800 km/h |
| **PÃ©riode** | 5-20 secondes | 10-60 minutes |
| **Ã‰nergie** | Surface | Colonne d'eau entiÃ¨re |
| **Comportement** | Brise sur plage | Inonde terres |

**Point crucial :** Une vague normale ne dÃ©place que l'eau de surface, tandis qu'un tsunami dÃ©place TOUTE la colonne d'eau du fond Ã  la surface.
            """,
            "en": """
**ğŸŒŠ DIFFERENCE BETWEEN TSUNAMI AND NORMAL WAVE**

| Characteristic | Normal Wave | Tsunami |
|----------------|-------------|---------|
| **Cause** | Wind | Earthquake/Landslide |
| **Wavelength** | 100-200 m | 100-200 km |
| **Speed** | 10-60 km/h | 500-800 km/h |
| **Period** | 5-20 seconds | 10-60 minutes |
| **Energy** | Surface | Entire water column |
| **Behavior** | Breaks on beach | Floods inland |

**Key point:** A normal wave only moves surface water, while a tsunami moves the ENTIRE water column from bottom to surface.
            """,
            "ar": """
**ğŸŒŠ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„ØªØ³ÙˆÙ†Ø§Ù…ÙŠ ÙˆØ§Ù„Ù…ÙˆØ¬Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©**

| Ø§Ù„Ø®Ø§ØµÙŠØ© | Ø§Ù„Ù…ÙˆØ¬Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© | Ø§Ù„ØªØ³ÙˆÙ†Ø§Ù…ÙŠ |
|----------|----------------|-----------|
| **Ø§Ù„Ø³Ø¨Ø¨** | Ø§Ù„Ø±ÙŠØ§Ø­ | Ø§Ù„Ø²Ù„Ø²Ø§Ù„/Ø§Ù„Ø§Ù†Ù‡ÙŠØ§Ø± |
| **Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ** | 100-200 Ù… | 100-200 ÙƒÙ… |
| **Ø§Ù„Ø³Ø±Ø¹Ø©** | 10-60 ÙƒÙ…/Ø³Ø§Ø¹Ø© | 500-800 ÙƒÙ…/Ø³Ø§Ø¹Ø© |
| **Ø§Ù„ÙØªØ±Ø©** | 5-20 Ø«Ø§Ù†ÙŠØ© | 10-60 Ø¯Ù‚ÙŠÙ‚Ø© |
| **Ø§Ù„Ø·Ø§Ù‚Ø©** | Ø§Ù„Ø³Ø·Ø­ | Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø§Ø¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ |
| **Ø§Ù„Ø³Ù„ÙˆÙƒ** | ÙŠÙ†ÙƒØ³Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø·Ø¦ | ÙŠØºÙ…Ø± Ø§Ù„ÙŠØ§Ø¨Ø³Ø© |

**Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:** Ø§Ù„Ù…ÙˆØ¬Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ØªØ­Ø±Ùƒ ÙÙ‚Ø· Ù…ÙŠØ§Ù‡ Ø§Ù„Ø³Ø·Ø­ØŒ Ø¨ÙŠÙ†Ù…Ø§ Ø§Ù„ØªØ³ÙˆÙ†Ø§Ù…ÙŠ ÙŠØ­Ø±Ùƒ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø§Ø¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¹ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø·Ø­.
            """
        }
    },
    
    "causes_principales": {
        "keywords": {
            "fr": ["causes", "origines", "pourquoi", "provoque", "cause tsunami", "origine tsunami"],
            "en": ["causes", "origins", "why", "cause", "tsunami causes", "tsunami origins"],
            "ar": ["Ø£Ø³Ø¨Ø§Ø¨", "Ù…ØµØ§Ø¯Ø±", "Ù„Ù…Ø§Ø°Ø§", "ÙŠØªØ³Ø¨Ø¨", "Ø£Ø³Ø¨Ø§Ø¨ ØªØ³ÙˆÙ†Ø§Ù…ÙŠ", "Ù…ØµØ§Ø¯Ø± ØªØ³ÙˆÙ†Ø§Ù…ÙŠ"]
        },
        "responses": {
            "fr": """
**ğŸ“Œ CAUSES PRINCIPALES DES TSUNAMIS**

**1. SÃ‰ISMES SOUS-MARINS (90% des cas)**
- **Magnitude minimale** : > 6.5 sur l'Ã©chelle de Richter
- **Type de faille** : Mouvement vertical essentiellement
- **Exemple** : Japon 2011 (magnitude 9.0), Sumatra 2004 (9.1)

**2. GLISSEMENTS DE TERRAIN SOUS-MARINS (7%)**
- **Volume** : Peut atteindre des kilomÃ¨tres cubes
- **Localisation** : Pentes continentales, volcans sous-marins
- **Exemple** : Papouasie-Nouvelle-GuinÃ©e 1998

**3. Ã‰RUPTIONS VOLCANIQUES (2%)**
- **MÃ©canisme** : Effondrement du volcan, entrÃ©e de matÃ©riaux
- **Exemple** : Krakatoa 1883 (vagues de 40m)

**4. IMPACTS DE MÃ‰TÃ‰ORITES (1%)**
- **RaretÃ©** : Ã‰vÃ©nements exceptionnels
- **Ã‰nergie** : ExtrÃªmement destructrice

**5. AUTRES CAUSES** : Explosions nuclÃ©aires sous-marines, effondrements glaciaires
            """,
            "en": """
**ğŸ“Œ MAIN TSUNAMI CAUSES**

**1. UNDERSEA EARTHQUAKES (90% of cases)**
- **Minimum magnitude**: > 6.5 on Richter scale
- **Fault type**: Primarily vertical movement
- **Example**: Japan 2011 (magnitude 9.0), Sumatra 2004 (9.1)

**2. SUBMARINE LANDSLIDES (7%)**
- **Volume**: Can reach cubic kilometers
- **Location**: Continental slopes, underwater volcanoes
- **Example**: Papua New Guinea 1998

**3. VOLCANIC ERUPTIONS (2%)**
- **Mechanism**: Volcano collapse, material entry
- **Example**: Krakatoa 1883 (40m waves)

**4. METEORITE IMPACTS (1%)**
- **Rarity**: Exceptional events
- **Energy**: Extremely destructive

**5. OTHER CAUSES**: Underwater nuclear explosions, glacial collapses
            """,
            "ar": """
**ğŸ“Œ Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ØªØ³ÙˆÙ†Ø§Ù…ÙŠ**

**1. Ø§Ù„Ø²Ù„Ø§Ø²Ù„ ØªØ­Øª Ø§Ù„Ø¨Ø­Ø± (90Ùª Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø§Øª)**
- **Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù‚ÙˆØ©**: > 6.5 Ø¹Ù„Ù‰ Ù…Ù‚ÙŠØ§Ø³ Ø±ÙŠØ®ØªØ±
- **Ù†ÙˆØ¹ Ø§Ù„ØµØ¯Ø¹**: Ø­Ø±ÙƒØ© Ø±Ø£Ø³ÙŠØ© primarily
- **Ù…Ø«Ø§Ù„**: Ø§Ù„ÙŠØ§Ø¨Ø§Ù† 2011 (Ù‚ÙˆØ© 9.0)ØŒ Ø³ÙˆÙ…Ø·Ø±Ø© 2004 (9.1)

**2. Ø§Ù„Ø§Ù†Ù‡ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£Ø±Ø¶ÙŠØ© ØªØ­Øª Ø§Ù„Ø¨Ø­Ø± (7Ùª)**
- **Ø§Ù„Ø­Ø¬Ù…**: ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØµÙ„ Ø¥Ù„Ù‰ ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª Ù…ÙƒØ¹Ø¨Ø©
- **Ø§Ù„Ù…ÙˆÙ‚Ø¹**: Ø§Ù„Ù…Ù†Ø­Ø¯Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø±ÙŠØ©ØŒ Ø§Ù„Ø¨Ø±Ø§ÙƒÙŠÙ† ØªØ­Øª Ø§Ù„Ù…Ø§Ø¡
- **Ù…Ø«Ø§Ù„**: Ø¨Ø§Ø¨ÙˆØ§ ØºÙŠÙ†ÙŠØ§ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 1998

**3. Ø§Ù„Ø«ÙˆØ±Ø§Øª Ø§Ù„Ø¨Ø±ÙƒØ§Ù†ÙŠØ© (2Ùª)**
- **Ø§Ù„Ø¢Ù„ÙŠØ©**: Ø§Ù†Ù‡ÙŠØ§Ø± Ø§Ù„Ø¨Ø±ÙƒØ§Ù†ØŒ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯
- **Ù…Ø«Ø§Ù„**: ÙƒØ±Ø§ÙƒØ§ØªÙˆØ§ 1883 (Ø£Ù…ÙˆØ§Ø¬ 40Ù…)

**4. Ø§ØµØ·Ø¯Ø§Ù… Ø§Ù„Ù†ÙŠØ§Ø²Ùƒ (1Ùª)**
- **Ø§Ù„Ù†Ø¯Ø±Ø©**: Ø£Ø­Ø¯Ø§Ø« Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØ©
- **Ø§Ù„Ø·Ø§Ù‚Ø©**: Ù…Ø¯Ù…Ø±Ø© Ù„Ù„ØºØ§ÙŠØ©

**5. Ø£Ø³Ø¨Ø§Ø¨ Ø£Ø®Ø±Ù‰**: Ø§Ù†ÙØ¬Ø§Ø±Ø§Øª Ù†ÙˆÙˆÙŠØ© ØªØ­Øª Ø§Ù„Ù…Ø§Ø¡ØŒ Ø§Ù†Ù‡ÙŠØ§Ø±Ø§Øª Ø¬Ù„ÙŠØ¯ÙŠØ©
            """
        }
    },
    
    "seisme_tsunami": {
        "keywords": {
            "fr": ["sÃ©isme", "tremblement de terre", "comment sÃ©isme", "mÃ©canisme sÃ©isme", "sÃ©isme provoque"],
            "en": ["earthquake", "how earthquake", "mechanism earthquake", "earthquake causes"],
            "ar": ["Ø²Ù„Ø²Ø§Ù„", "ÙƒÙŠÙ Ø²Ù„Ø²Ø§Ù„", "Ø¢Ù„ÙŠØ© Ø²Ù„Ø²Ø§Ù„", "Ø²Ù„Ø²Ø§Ù„ ÙŠØªØ³Ø¨Ø¨"]
        },
        "responses": {
            "fr": """
**ğŸ”¬ COMMENT UN SÃ‰ISME PROVOQUE UN TSUNAMI**

**Processus en 4 Ã©tapes :**

**1. RUPTURE SOUS-MARINE**
- Faille tectonique se rompt sous l'ocÃ©an
- DÃ©placement vertical du plancher ocÃ©anique (jusqu'Ã  10m)
- Temps : Quelques secondes Ã  minutes

**2. DÃ‰PLACEMENT D'EAU**
- La colonne d'eau est poussÃ©e vers le haut ou tirÃ©e vers le bas
- CrÃ©ation d'une "bosse" d'eau Ã  la surface
- Ã‰nergie transmise Ã  toute la colonne d'eau

**3. PROPAGATION DES ONDES**
- Ondes se propagent Ã  800 km/h en eau profonde
- Longue distance avec peu de perte d'Ã©nergie
- Amplification prÃ¨s des cÃ´tes

**4. DÃ‰FERLEMENT CÃ”TIER**
- Ralentissement en eau peu profonde
- Amplitude des vagues multipliÃ©e par 10-30
- Inondation des terres

**Conditions nÃ©cessaires :**
- Magnitude > 6.5
- Faille Ã  mouvement vertical
- Profondeur < 50 km
            """,
            "en": """
**ğŸ”¬ HOW AN EARTHQUAKE CAUSES A TSUNAMI**

**4-step process:**

**1. UNDERSEA RUPTURE**
- Tectonic fault breaks under ocean
- Vertical displacement of ocean floor (up to 10m)
- Time: Few seconds to minutes

**2. WATER DISPLACEMENT**
- Water column pushed upward or pulled downward
- Creation of water "bulge" at surface
- Energy transmitted to entire water column

**3. WAVE PROPAGATION**
- Waves propagate at 800 km/h in deep water
- Long distance with little energy loss
- Amplification near coasts

**4. COASTAL BREAKING**
- Slowing in shallow water
- Wave amplitude multiplied by 10-30
- Land flooding

**Required conditions:**
- Magnitude > 6.5
- Vertical movement fault
- Depth < 50 km
            """,
            "ar": """
**ğŸ”¬ ÙƒÙŠÙ ÙŠØªØ³Ø¨Ø¨ Ø§Ù„Ø²Ù„Ø²Ø§Ù„ ÙÙŠ ØªØ³ÙˆÙ†Ø§Ù…ÙŠ**

**Ø¹Ù…Ù„ÙŠØ© Ù…Ù† 4 Ø®Ø·ÙˆØ§Øª:**

**1. ØªÙ…Ø²Ù‚ ØªØ­Øª Ø§Ù„Ø¨Ø­Ø±**
- Ø§Ù†ÙƒØ³Ø§Ø± Ø§Ù„ØµØ¯Ø¹ Ø§Ù„ØªÙƒØªÙˆÙ†ÙŠ ØªØ­Øª Ø§Ù„Ù…Ø­ÙŠØ·
- Ø§Ù„Ø§Ù†Ø²ÙŠØ§Ø­ Ø§Ù„Ø±Ø£Ø³ÙŠ Ù„Ù‚Ø§Ø¹ Ø§Ù„Ù…Ø­ÙŠØ· (Ø­ØªÙ‰ 10Ù…)
- Ø§Ù„ÙˆÙ‚Øª: Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù† Ø¥Ù„Ù‰ Ø¯Ù‚Ø§Ø¦Ù‚

**2. Ø¥Ø²Ø§Ø­Ø© Ø§Ù„Ù…Ø§Ø¡**
- Ø¯ÙØ¹ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø§Ø¡ Ù„Ø£Ø¹Ù„Ù‰ Ø£Ùˆ Ø³Ø­Ø¨Ù‡ Ù„Ø£Ø³ÙÙ„
- ØªÙƒÙˆÙŠÙ† "Ø§Ù†ØªÙØ§Ø®" Ù…Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø·Ø­
- Ù†Ù‚Ù„ Ø§Ù„Ø·Ø§Ù‚Ø© Ø¥Ù„Ù‰ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø§Ø¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„

**3. Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ù…ÙˆØ¬**
- Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø£Ù…ÙˆØ§Ø¬ Ø¨Ø³Ø±Ø¹Ø© 800 ÙƒÙ…/Ø³Ø§Ø¹Ø© ÙÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¹Ù…ÙŠÙ‚Ø©
- Ù…Ø³Ø§ÙØ© Ø·ÙˆÙŠÙ„Ø© Ù…Ø¹ ÙÙ‚Ø¯Ø§Ù† Ø·Ø§Ù‚Ø© Ù‚Ù„ÙŠÙ„
- ØªØ¶Ø®ÙŠÙ… Ø¨Ø§Ù„Ù‚Ø±Ø¨ Ù…Ù† Ø§Ù„Ø³ÙˆØ§Ø­Ù„

**4. Ø§Ù†ÙƒØ³Ø§Ø± Ø³Ø§Ø­Ù„ÙŠ**
- Ø§Ù„ØªØ¨Ø§Ø·Ø¤ ÙÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¶Ø­Ù„Ø©
- ØªØ¶Ø®ÙŠÙ… Ø³Ø¹Ø© Ø§Ù„Ù…ÙˆØ¬Ø© 10-30 Ù…Ø±Ø©
- ÙÙŠØ¶Ø§Ù† Ø§Ù„ÙŠØ§Ø¨Ø³Ø©

**Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:**
- Ù‚ÙˆØ© > 6.5
- ØµØ¯Ø¹ Ø¨Ø­Ø±ÙƒØ© Ø±Ø£Ø³ÙŠØ©
- Ø¹Ù…Ù‚ < 50 ÙƒÙ…
            """
        }
    },
    
    "volcan_glissement_tsunami": {
        "keywords": {
            "fr": ["volcan", "volcanique", "glissement", "Ã©ruption", "volcan tsunami", "glissement terrain"],
            "en": ["volcano", "volcanic", "landslide", "eruption", "volcano tsunami", "landslide tsunami"],
            "ar": ["Ø¨Ø±ÙƒØ§Ù†", "Ø¨Ø±ÙƒØ§Ù†ÙŠ", "Ø§Ù†Ù‡ÙŠØ§Ø±", "Ø«ÙˆØ±Ø§Ù†", "Ø¨Ø±ÙƒØ§Ù† ØªØ³ÙˆÙ†Ø§Ù…ÙŠ", "Ø§Ù†Ù‡ÙŠØ§Ø± Ø£Ø±Ø¶ÙŠ"]
        },
        "responses": {
            "fr": """
**ğŸŒ‹ TSUNAMIS VOLCANIQUES ET PAR GLISSEMENTS**

**TSUNAMIS VOLCANIQUES :**

**MÃ©canismes :**
1. **Effondrement du volcan** - Flancs qui s'effondrent dans la mer
2. **Pyroclastiques** - Flux de matÃ©riaux entrant dans l'eau
3. **Explosions sous-marines** - Vapeur et gaz sous pression

**Exemples cÃ©lÃ¨bres :**
- **Krakatoa 1883** : Vagues de 40m, 36,000 morts
- **Santorin 1600 av.J-C** : Possible fin de la civilisation minoenne

**TSUNAMIS PAR GLISSEMENTS :**

**Types de glissements :**
- **Sous-marins** : Effondrement pentes continentales
- **AÃ©riens** : Roches/glaciers tombant dans fjords/lacs

**CaractÃ©ristiques :**
- Plus localisÃ©s mais trÃ¨s destructeurs localement
- Peuvent survenir sans sÃ©isme prÃ©alable
- Difficiles Ã  prÃ©voir

**Exemple :** Baie Lituya 1958 - Vague de 524m (record mondial)
            """,
            "en": """
**ğŸŒ‹ VOLCANIC AND LANDSLIDE TSUNAMIS**

**VOLCANIC TSUNAMIS:**

**Mechanisms:**
1. **Volcano collapse** - Flanks collapsing into sea
2. **Pyroclastics** - Material flows entering water
3. **Underwater explosions** - Steam and pressurized gas

**Famous examples:**
- **Krakatoa 1883**: 40m waves, 36,000 deaths
- **Santorini 1600 BC**: Possible end of Minoan civilization

**LANDSLIDE TSUNAMIS:**

**Landslide types:**
- **Submarine**: Continental slope collapses
- **Aerial**: Rocks/glaciers falling into fjords/lakes

**Characteristics:**
- More localized but very destructive locally
- Can occur without prior earthquake
- Difficult to predict

**Example:** Lituya Bay 1958 - 524m wave (world record)
            """,
            "ar": """
**ğŸŒ‹ ØªØ³ÙˆÙ†Ø§Ù…ÙŠ Ø§Ù„Ø¨Ø±Ø§ÙƒÙŠÙ† ÙˆØ§Ù„Ø§Ù†Ù‡ÙŠØ§Ø±Ø§Øª**

**ØªØ³ÙˆÙ†Ø§Ù…ÙŠ Ø§Ù„Ø¨Ø±Ø§ÙƒÙŠÙ†:**

**Ø§Ù„Ø¢Ù„ÙŠØ§Øª:**
1. **Ø§Ù†Ù‡ÙŠØ§Ø± Ø§Ù„Ø¨Ø±ÙƒØ§Ù†** - Ø§Ù†Ù‡ÙŠØ§Ø± Ø§Ù„Ø£Ø¬Ù†Ø¨Ø© ÙÙŠ Ø§Ù„Ø¨Ø­Ø±
2. **Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¨Ø±ÙƒØ§Ù†ÙŠØ©** - ØªØ¯ÙÙ‚ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø§Ø¡
3. **Ø§Ù†ÙØ¬Ø§Ø±Ø§Øª ØªØ­Øª Ø§Ù„Ù…Ø§Ø¡** - Ø§Ù„Ø¨Ø®Ø§Ø± ÙˆØ§Ù„ØºØ§Ø² Ø§Ù„Ù…Ø¶ØºÙˆØ·

**Ø£Ù…Ø«Ù„Ø© Ù…Ø´Ù‡ÙˆØ±Ø©:**
- **ÙƒØ±Ø§ÙƒØ§ØªÙˆØ§ 1883**: Ø£Ù…ÙˆØ§Ø¬ 40Ù…ØŒ 36,000 ÙˆÙØ§Ø©
- **Ø³Ø§Ù†ØªÙˆØ±ÙŠÙ†ÙŠ 1600 Ù‚.Ù…**: Ù†Ù‡Ø§ÙŠØ© Ù…Ø­ØªÙ…Ù„Ø© Ù„Ù„Ø­Ø¶Ø§Ø±Ø© Ø§Ù„Ù…ÙŠÙ†ÙˆÙŠØ©

**ØªØ³ÙˆÙ†Ø§Ù…ÙŠ Ø§Ù„Ø§Ù†Ù‡ÙŠØ§Ø±Ø§Øª:**

**Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø§Ù†Ù‡ÙŠØ§Ø±Ø§Øª:**
- **ØªØ­Øª Ø§Ù„Ø¨Ø­Ø±**: Ø§Ù†Ù‡ÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø­Ø¯Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø±ÙŠØ©
- **Ø¬ÙˆÙŠ**: ØµØ®ÙˆØ±/Ø£Ù†Ù‡Ø§Ø± Ø¬Ù„ÙŠØ¯ÙŠØ© ØªØ³Ù‚Ø· ÙÙŠ Ø§Ù„Ù…Ø¶Ø§ÙŠÙ‚/Ø§Ù„Ø¨Ø­ÙŠØ±Ø§Øª

**Ø§Ù„Ø®ØµØ§Ø¦Øµ:**
- Ø£ÙƒØ«Ø± ØªÙ…Ø±ÙƒØ²Ù‹Ø§ ÙˆÙ„ÙƒÙ† Ù…Ø¯Ù…Ø±Ø© Ø¬Ø¯Ù‹Ø§ Ù…Ø­Ù„ÙŠÙ‹Ø§
- ÙŠÙ…ÙƒÙ† Ø£Ù† ØªØ­Ø¯Ø« Ø¨Ø¯ÙˆÙ† Ø²Ù„Ø²Ø§Ù„ Ù…Ø³Ø¨Ù‚
- ØµØ¹Ø¨Ø© Ø§Ù„ØªÙ†Ø¨Ø¤

**Ù…Ø«Ø§Ù„:** Ø®Ù„ÙŠØ¬ Ù„ÙŠØªÙˆÙŠØ§ 1958 - Ù…ÙˆØ¬Ø© 524Ù… (Ø±Ù‚Ù… Ù‚ÙŠØ§Ø³ÙŠ Ø¹Ø§Ù„Ù…ÙŠ)
            """
        }
    },
    
    "signes_precurseurs": {
        "keywords": {
            "fr": ["signes", "prÃ©curseurs", "alerte", "avant tsunami", "signes avant", "reconnaÃ®tre"],
            "en": ["signs", "warning", "alert", "before tsunami", "warning signs", "recognize"],
            "ar": ["Ø¹Ù„Ø§Ù…Ø§Øª", "Ø¥Ù†Ø°Ø§Ø±", "Ù‚Ø¨Ù„ ØªØ³ÙˆÙ†Ø§Ù…ÙŠ", "Ø¹Ù„Ø§Ù…Ø§Øª Ø¥Ù†Ø°Ø§Ø±", "ÙŠØªØ¹Ø±Ù"]
        },
        "responses": {
            "fr": """
**âš ï¸ SIGNES PRÃ‰CURSEURS D'UN TSUNAMI**

**SIGNES NATURELS (Ã€ CONNAÃTRE ABSOLUMENT) :**

**1. SÃ‰ISME FORT ET LONG**
- DurÃ©e > 20 secondes
- Impossible de rester debout
- Secousses violentes

**2. RETRAIT SOUDAIN DE LA MER**
- Mer qui se retire anormalement loin
- Fond marin visible sur des centaines de mÃ¨tres
- **ATTENTION** : Ce n'est pas le moment de prendre des photos !

**3. BRUIT ANORMAL**
- Bruit de locomotive ou d'avion Ã  rÃ©action
- Grondement sourd venant de l'ocÃ©an

**4. COMPORTEMENT ANIMAL**
- Animaux qui fuient vers les hauteurs
- Oiseaux qui s'envolent en masse

**SIGNES OFFICIELS :**
- SirÃ¨nes d'alerte tsunami
- Messages d'urgence sur tÃ©lÃ©phone
- Alertes mÃ©dias et radio

**RÃˆGLE D'OR :** En cas de sÃ©isme cÃ´tier, Ã©vacuez immÃ©diatement sans attendre les signes visuels !
            """,
            "en": """
**âš ï¸ TSUNAMI WARNING SIGNS**

**NATURAL SIGNS (MUST KNOW):**

**1. STRONG, LONG EARTHQUAKE**
- Duration > 20 seconds
- Cannot stand upright
- Violent shaking

**2. SUDDEN SEA RETREAT**
- Sea retreating abnormally far
- Seabed visible for hundreds of meters
- **WARNING**: Not the time for photos!

**3. ABNORMAL NOISE**
- Locomotive or jet engine noise
- Deep roar from ocean

**4. ANIMAL BEHAVIOR**
- Animals fleeing to high ground
- Birds flying away en masse

**OFFICIAL SIGNS:**
- Tsunami warning sirens
- Emergency phone messages
- Media and radio alerts

**GOLDEN RULE:** During coastal earthquake, evacuate immediately without waiting for visual signs!
            """,
            "ar": """
**âš ï¸ Ø¹Ù„Ø§Ù…Ø§Øª Ø¥Ù†Ø°Ø§Ø± Ø§Ù„ØªØ³ÙˆÙ†Ø§Ù…ÙŠ**

**Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© (ÙŠØ¬Ø¨ Ù…Ø¹Ø±ÙØªÙ‡Ø§):**

**1. Ø²Ù„Ø²Ø§Ù„ Ù‚ÙˆÙŠ ÙˆØ·ÙˆÙŠÙ„**
- Ø§Ù„Ù…Ø¯Ø© > 20 Ø«Ø§Ù†ÙŠØ©
- Ø¹Ø¯Ù… Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚ÙˆÙ
- Ø§Ù‡ØªØ²Ø§Ø²Ø§Øª Ø¹Ù†ÙŠÙØ©

**2. Ø§Ù†Ø³Ø­Ø§Ø¨ Ù…ÙØ§Ø¬Ø¦ Ù„Ù„Ø¨Ø­Ø±**
- ØªØ±Ø§Ø¬Ø¹ Ø§Ù„Ø¨Ø­Ø± Ø¨Ø´ÙƒÙ„ ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠ
- Ù‚Ø§Ø¹ Ø§Ù„Ø¨Ø­Ø± Ù…Ø±Ø¦ÙŠ Ù„Ù…Ø¦Ø§Øª Ø§Ù„Ø£Ù…ØªØ§Ø±
- **ØªØ­Ø°ÙŠØ±**: Ù„ÙŠØ³ ÙˆÙ‚ØªÙ‹Ø§ Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±!

**3. Ø¶Ø¬ÙŠØ¬ ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠ**
- Ø¶Ø¬ÙŠØ¬ Ù…Ø«Ù„ Ø§Ù„Ù‚Ø·Ø§Ø± Ø£Ùˆ Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ù†ÙØ§Ø«
- Ù‡Ø¯ÙŠØ± Ø¹Ù…ÙŠÙ‚ Ù‚Ø§Ø¯Ù… Ù…Ù† Ø§Ù„Ù…Ø­ÙŠØ·

**4. Ø³Ù„ÙˆÙƒ Ø§Ù„Ø­ÙŠÙˆØ§Ù†**
- Ø­ÙŠÙˆØ§Ù†Ø§Øª ØªÙ‡Ø±Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø±ØªÙØ¹Ø§Øª
- Ø·ÙŠÙˆØ± ØªØ·ÙŠØ± Ø¨Ø¹ÙŠØ¯Ù‹Ø§ Ø¨Ø£Ø¹Ø¯Ø§Ø¯ ÙƒØ¨ÙŠØ±Ø©

**Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©:**
- ØµÙØ§Ø±Ø§Øª Ø¥Ù†Ø°Ø§Ø± Ø§Ù„ØªØ³ÙˆÙ†Ø§Ù…ÙŠ
- Ø±Ø³Ø§Ø¦Ù„ Ø·ÙˆØ§Ø±Ø¦ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ
- ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù… ÙˆØ§Ù„Ø±Ø§Ø¯ÙŠÙˆ

**Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©:** Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø²Ù„Ø²Ø§Ù„ Ø§Ù„Ø³Ø§Ø­Ù„ÙŠØŒ Ø§Ø®Ù„ ÙÙˆØ±Ù‹Ø§ Ø¯ÙˆÙ† Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø±Ø¦ÙŠØ©!
            """
        }
    },
    
    # ========== CONSÃ‰QUENCES ==========
    "consequences_humaines": {
        "keywords": {
            "fr": ["consÃ©quences humaines", "victimes", "morts", "dÃ©cÃ¨s", "impact humain"],
            "en": ["human consequences", "victims", "deaths", "human impact"],
            "ar": ["Ø¹ÙˆØ§Ù‚Ø¨ Ø¨Ø´Ø±ÙŠØ©", "Ø¶Ø­Ø§ÙŠØ§", "ÙˆÙÙŠØ§Øª", "ØªØ£Ø«ÙŠØ± Ø¨Ø´Ø±ÙŠ"]
        },
        "responses": {
            "fr": """
**ğŸ˜¢ CONSÃ‰QUENCES HUMAINES DES TSUNAMIS**

**IMPACTS IMMÃ‰DIATS :**

**1. MORTS ET BLESSÃ‰S**
- **Noyade** (cause principale de dÃ©cÃ¨s)
- **Traumatismes physiques** (fractures, blessures)
- **Hypothermie** en eau froide

**2. DÃ‰PLACEMENTS DE POPULATION**
- Maisons dÃ©truites
- Infrastructures endommagÃ©es
- RÃ©fugiÃ©s environnementaux

**STATISTIQUES :**
- **Tsunami 2004** : 230,000-280,000 morts
- **Japon 2011** : 18,000 morts confirmÃ©s
- **Moyenne historique** : Variable selon l'Ã©vÃ©nement

**FACTEURS INFLUENÃ‡ANT LA MORTALITÃ‰ :**
- DensitÃ© de population cÃ´tiÃ¨re
- Heure de la journÃ©e (nuit = plus dangereux)
- SystÃ¨mes d'alerte en place
- Ã‰ducation de la population
            """,
            "en": """
**ğŸ˜¢ HUMAN CONSEQUENCES OF TSUNAMIS**

**IMMEDIATE IMPACTS:**

**1. DEATHS AND INJURIES**
- **Drowning** (main cause of death)
- **Physical trauma** (fractures, injuries)
- **Hypothermia** in cold water

**2. POPULATION DISPLACEMENT**
- Homes destroyed
- Damaged infrastructure
- Environmental refugees

**STATISTICS:**
- **2004 tsunami**: 230,000-280,000 deaths
- **Japan 2011**: 18,000 confirmed deaths
- **Historical average**: Varies by event

**FACTORS INFLUENCING MORTALITY:**
- Coastal population density
- Time of day (night = more dangerous)
- Warning systems in place
- Population education
            """,
            "ar": """
**ğŸ˜¢ Ø§Ù„Ø¹ÙˆØ§Ù‚Ø¨ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© Ù„Ù„ØªØ³ÙˆÙ†Ø§Ù…ÙŠ**

**Ø§Ù„Ø¢Ø«Ø§Ø± Ø§Ù„ÙÙˆØ±ÙŠØ©:**

**1. Ø§Ù„ÙˆÙÙŠØ§Øª ÙˆØ§Ù„Ø¥ØµØ§Ø¨Ø§Øª**
- **Ø§Ù„ØºØ±Ù‚** (Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„ÙˆÙØ§Ø©)
- **Ø§Ù„ØµØ¯Ù…Ø§Øª Ø§Ù„Ø¬Ø³Ø¯ÙŠØ©** (ÙƒØ³ÙˆØ±ØŒ Ø¥ØµØ§Ø¨Ø§Øª)
- **Ø§Ù†Ø®ÙØ§Ø¶ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø¬Ø³Ù…** ÙÙŠ Ø§Ù„Ù…Ø§Ø¡ Ø§Ù„Ø¨Ø§Ø±Ø¯

**2. Ù†Ø²ÙˆØ­ Ø§Ù„Ø³ÙƒØ§Ù†**
- ØªØ¯Ù…ÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø²Ù„
- ØªÙ„Ù Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ©
- Ù„Ø§Ø¬Ø¦ÙˆÙ† Ø¨ÙŠØ¦ÙŠÙˆÙ†

**Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:**
- **ØªØ³ÙˆÙ†Ø§Ù…ÙŠ 2004**: 230,000-280,000 ÙˆÙØ§Ø©
- **Ø§Ù„ÙŠØ§Ø¨Ø§Ù† 2011**: 18,000 ÙˆÙØ§Ø© Ù…Ø¤ÙƒØ¯Ø©
- **Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ**: ÙŠØ®ØªÙ„Ù Ø­Ø³Ø¨ Ø§Ù„Ø­Ø¯Ø«

**Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ù…Ø¤Ø«Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙÙŠØ§Øª:**
- ÙƒØ«Ø§ÙØ© Ø§Ù„Ø³ÙƒØ§Ù† Ø§Ù„Ø³Ø§Ø­Ù„ÙŠÙŠÙ†
- ÙˆÙ‚Øª Ø§Ù„ÙŠÙˆÙ… (Ø§Ù„Ù„ÙŠÙ„ = Ø£ÙƒØ«Ø± Ø®Ø·ÙˆØ±Ø©)
- Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø¥Ù†Ø°Ø§Ø± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
- ØªØ«Ù‚ÙŠÙ Ø§Ù„Ø³ÙƒØ§Ù†
            """
        }
    }
}

# ==================== FONCTION DE RECHERCHE AMÃ‰LIORÃ‰E ====================

def find_response(user_input, language):
    """Trouve la rÃ©ponse la plus pertinente avec reconnaissance amÃ©liorÃ©e"""
    user_input_lower = user_input.lower()
    
    # Recherche amÃ©liorÃ©e - vÃ©rifie chaque mot-clÃ© individuellement
    best_match = None
    best_score = 0
    
    for category, data in KNOWLEDGE_BASE.items():
        score = 0
        for keyword in data["keywords"][language]:
            if keyword in user_input_lower:
                score += 1
        
        if score > best_score:
            best_score = score
            best_match = category
    
    # Si on a trouvÃ© une bonne correspondance
    if best_score >= 1:
        return KNOWLEDGE_BASE[best_match]["responses"][language]
    
    # Recherche de secours avec mots individuels
    for category, data in KNOWLEDGE_BASE.items():
        for keyword in data["keywords"][language]:
            # VÃ©rifie si des mots individuels correspondent
            words = user_input_lower.split()
            for word in words:
                if word in keyword or keyword in word:
                    return data["responses"][language]
    
    # RÃ©ponse par dÃ©faut
    default_responses = {
        "fr": "ğŸ¤– **Expert Tsunami** - Je n'ai pas compris votre question. Essayez avec : dÃ©finition, causes, sÃ©isme, volcan, consÃ©quences, ou signes avant-coureurs.",
        "en": "ğŸ¤– **Tsunami Expert** - I didn't understand your question. Try with: definition, causes, earthquake, volcano, consequences, or warning signs.",
        "ar": "ğŸ¤– **Ø®Ø¨ÙŠØ± Ø§Ù„ØªØ³ÙˆÙ†Ø§Ù…ÙŠ** - Ù„Ù… Ø£ÙÙ‡Ù… Ø³Ø¤Ø§Ù„Ùƒ. Ø¬Ø±Ø¨ Ù…Ø¹: ØªØ¹Ø±ÙŠÙØŒ Ø£Ø³Ø¨Ø§Ø¨ØŒ Ø²Ù„Ø²Ø§Ù„ØŒ Ø¨Ø±ÙƒØ§Ù†ØŒ Ø¹ÙˆØ§Ù‚Ø¨ØŒ Ø£Ùˆ Ø¹Ù„Ø§Ù…Ø§Øª Ø¥Ù†Ø°Ø§Ø±."
    }
    return default_responses[language]

def display_text(text, language):
    """Affiche le texte avec la bonne direction"""
    if language == "ar":
        st.markdown(f'<div class="arabic-text">{text}</div>', unsafe_allow_html=True)
    else:
        st.markdown(text)

# ==================== INTERFACE ====================

# Titre
st.markdown('<div class="main-header">ğŸŒŠ Expert Tsunami</div>', unsafe_allow_html=True)

# Sidebar
with st.sidebar:
    st.markdown("### ğŸŒ Langue")
    selected_language = st.radio("", list(LANGUAGES.keys()), label_visibility="collapsed")
    current_lang = LANGUAGES[selected_language]
    
    # Questions par catÃ©gorie
    categories = {
        "fr": {
            "definition": "ğŸ“š DÃ©finition et Causes",
            "consequences": "ğŸ’¥ ConsÃ©quences"
        },
        "en": {
            "definition": "ğŸ“š Definition and Causes", 
            "consequences": "ğŸ’¥ Consequences"
        },
        "ar": {
            "definition": "ğŸ“š Ø§Ù„ØªØ¹Ø±ÙŠÙ ÙˆØ§Ù„Ø£Ø³Ø¨Ø§Ø¨",
            "consequences": "ğŸ’¥ Ø§Ù„Ø¹ÙˆØ§Ù‚Ø¨"
        }
    }
    
    questions_by_category = {
        "definition": {
            "fr": [
                "Qu'est-ce qu'un tsunami ?",
                "DiffÃ©rence avec vague normale", 
                "Causes principales",
                "Comment un sÃ©isme provoque un tsunami",
                "Tsunamis volcaniques et glissements",
                "Signes avant-coureurs"
            ],
            "en": [
                "What is a tsunami?",
                "Difference with normal wave",
                "Main causes",
                "How earthquake causes tsunami", 
                "Volcanic and landslide tsunamis",
                "Warning signs"
            ],
            "ar": [
                "Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªØ³ÙˆÙ†Ø§Ù…ÙŠØŸ",
                "Ø§Ù„ÙØ±Ù‚ Ù…Ø¹ Ø§Ù„Ù…ÙˆØ¬Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©",
                "Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
                "ÙƒÙŠÙ ÙŠØªØ³Ø¨Ø¨ Ø§Ù„Ø²Ù„Ø²Ø§Ù„ ÙÙŠ ØªØ³ÙˆÙ†Ø§Ù…ÙŠ",
                "ØªØ³ÙˆÙ†Ø§Ù…ÙŠ Ø§Ù„Ø¨Ø±Ø§ÙƒÙŠÙ† ÙˆØ§Ù„Ø§Ù†Ù‡ÙŠØ§Ø±Ø§Øª", 
                "Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø¥Ù†Ø°Ø§Ø±"
            ]
        },
        "consequences": {
            "fr": [
                "ConsÃ©quences humaines",
                "Impacts Ã©conomiques"
            ],
            "en": [
                "Human consequences", 
                "Economic impacts"
            ],
            "ar": [
                "Ø§Ù„Ø¹ÙˆØ§Ù‚Ø¨ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©",
                "Ø§Ù„Ø¢Ø«Ø§Ø± Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©"
            ]
        }
    }
    
    for category_key, category_name in categories[current_lang].items():
        st.markdown(f'<div class="category-header">{category_name}</div>', unsafe_allow_html=True)
        for question in questions_by_category[category_key][current_lang]:
            if st.button(question, key=f"{category_key}_{question}"):
                st.session_state.auto_question = question
    
    st.markdown("---")
    st.markdown("### ğŸš¨ Urgence")
    st.markdown("**Ã‰loignement immÃ©diat**")
    st.markdown("**112 â€¢ 911 â€¢ 999**")

# Zone de chat
st.markdown('<div class="chat-container">', unsafe_allow_html=True)

# Historique de conversation
if "messages" not in st.session_state:
    welcome_messages = {
        "fr": "ğŸŒŠ **Expert Tsunami** - Je peux rÃ©pondre Ã  vos questions sur : dÃ©finition, causes, consÃ©quences des tsunamis. Utilisez les boutons ou tapez vos questions !",
        "en": "ğŸŒŠ **Tsunami Expert** - I can answer your questions about: definition, causes, consequences of tsunamis. Use buttons or type your questions!", 
        "ar": "ğŸŒŠ **Ø®Ø¨ÙŠØ± Ø§Ù„ØªØ³ÙˆÙ†Ø§Ù…ÙŠ** - ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„ØªÙƒ Ø¹Ù†: ØªØ¹Ø±ÙŠÙØŒ Ø£Ø³Ø¨Ø§Ø¨ØŒ Ø¹ÙˆØ§Ù‚Ø¨ Ø§Ù„ØªØ³ÙˆÙ†Ø§Ù…ÙŠ. Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ùˆ Ø§ÙƒØªØ¨ Ø£Ø³Ø¦Ù„ØªÙƒ!"
    }
    st.session_state.messages = [
        {"role": "assistant", "content": welcome_messages[current_lang]}
    ]

# Affichage de l'historique
for message in st.session_state.messages:
    with st.chat_message(message["role"]):
        display_text(message["content"], current_lang)

# Gestion des questions automatiques
if "auto_question" in st.session_state:
    prompt = st.session_state.auto_question
    del st.session_state.auto_question
else:
    prompt = None

# Input utilisateur
if prompt or (user_input := st.chat_input("ğŸ’¬ Posez votre question...")):
    
    if not prompt:
        prompt = user_input
    
    # Ajout du message utilisateur
    st.session_state.messages.append({"role": "user", "content": prompt})
    
    # GÃ©nÃ©ration de la rÃ©ponse
    response = find_response(prompt, current_lang)
    
    # Ajout de la rÃ©ponse
    st.session_state.messages.append({
        "role": "assistant", 
        "content": response
    })
    
    st.rerun()
